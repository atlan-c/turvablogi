name: Post-deploy health check

on:
  workflow_run:
    workflows: ["Deploy Hugo site to Pages"]
    types: [completed]

jobs:
  check-site:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Wait for Pages propagation
        run: sleep 20

      - name: Check site root
        run: |
          URL="https://atlan-c.github.io/turvablogi/"
          code=$(curl -s -o /tmp/site.html -w "%{http_code}" "$URL")
          echo "HTTP status: $code"
          test "$code" = "200"

      - name: Validate expected content
        run: |
          grep -qi "Turvablogi" /tmp/site.html
          grep -qi "Uusimmat postaukset" /tmp/site.html
